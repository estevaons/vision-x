<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Simulador ESP32-CAM</title>
</head>
<body>
  <h2>Simulador ESP32-CAM</h2>
  <input type="file" id="imageInput" accept="image/*" />
  <button id="sendBtn">Enviar Imagem</button>

  <script>
    // Usa o mesmo host e porta da página para o WebSocket (ajuste se necessário)
    const wsProtocol = location.protocol === 'https:' ? 'wss' : 'ws';
    const wsUrl = `${wsProtocol}://${location.host}`;

    const socket = new WebSocket(wsUrl);

    socket.addEventListener('open', () => {
      console.log('Conectado ao servidor WebSocket');
      socket.send(JSON.stringify({ type: 'register', role: 'esp32' }));
    });

    socket.addEventListener('error', (event) => {
      console.error('Erro no WebSocket:', event);
    });

    socket.addEventListener('close', () => {
      console.log('Conexão WebSocket fechada');
    });

    document.getElementById('sendBtn').addEventListener('click', () => {
      const fileInput = document.getElementById('imageInput');
      const file = fileInput.files[0];

      if (!file) return alert('Selecione uma imagem primeiro');

      const reader = new FileReader();
      reader.onload = () => {
        const base64Image = reader.result.split(',')[1];
        const message = {
          type: 'image',
          data: base64Image
        };

        if (socket.readyState === WebSocket.OPEN) {
          socket.send(JSON.stringify(message));
          alert('Imagem enviada!');
        } else {
          alert('WebSocket não está conectado.');
        }
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
